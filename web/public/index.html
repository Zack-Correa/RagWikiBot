<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BeeWiki Admin - Dashboard</title>
    <link rel="stylesheet" href="/style.css">
    <link rel="icon" href="/assets/logo.png" type="image/png">
</head>
<body>
    <nav class="navbar">
        <div class="nav-brand">
            <img src="/assets/logo.png" alt="BeeWiki" class="nav-logo">
            BeeWiki Admin
        </div>
        <div class="nav-links">
            <a href="#dashboard" class="nav-link active" data-section="dashboard">Dashboard</a>
            <a href="#metrics" class="nav-link" data-section="metrics">M√©tricas</a>
            <a href="#alerts" class="nav-link" data-section="alerts">Alertas</a>
            <a href="#parties" class="nav-link" data-section="parties">Grupos</a>
            <a href="#config" class="nav-link" data-section="config">Configura√ß√µes</a>
            <a href="#whitelist" class="nav-link" data-section="whitelist">Permiss√µes</a>
            <a href="#news" class="nav-link" data-section="news">Not√≠cias</a>
            <a href="#deploy" class="nav-link" data-section="deploy">Deploy</a>
            <a href="#logs" class="nav-link" data-section="logs">Logs</a>
            <a href="/logout" class="nav-link logout">Sair</a>
        </div>
    </nav>

    <main class="container">
        <!-- Dashboard Section -->
        <section id="dashboard" class="section active">
            <h2>Dashboard</h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="stat-total-alerts">-</div>
                    <div class="stat-label">Total de Alertas</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-unique-users">-</div>
                    <div class="stat-label">Usu√°rios</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-unique-searches">-</div>
                    <div class="stat-label">Buscas √önicas</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-service-status">-</div>
                    <div class="stat-label">Status do Servi√ßo</div>
                </div>
            </div>
            
            <div class="info-card">
                <h3>Informa√ß√µes do Sistema</h3>
                <div class="info-row">
                    <span class="info-label">√öltima Verifica√ß√£o:</span>
                    <span class="info-value" id="info-last-check">-</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Intervalo:</span>
                    <span class="info-value" id="info-interval">-</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Cooldown:</span>
                    <span class="info-value" id="info-cooldown">-</span>
                </div>
            </div>
            
            <div class="actions-card">
                <h3>A√ß√µes</h3>
                <div class="actions-buttons">
                    <button class="btn btn-primary" id="btn-force-check">For√ßar Verifica√ß√£o</button>
                    <button class="btn btn-warning" id="btn-toggle-service">Parar Servi√ßo</button>
                    <button class="btn btn-secondary" id="btn-refresh">Atualizar</button>
                </div>
            </div>
            
            <div class="server-status-card">
                <h3>üñ•Ô∏è Status dos Servidores</h3>
                <div class="server-status-grid" id="server-status-grid">
                    <div class="loading">Carregando...</div>
                </div>
                <div class="server-status-info">
                    <span class="info-label">√öltima verifica√ß√£o:</span>
                    <span class="info-value" id="server-last-check">-</span>
                    <span class="info-label" style="margin-left: 20px;">Servidor:</span>
                    <span class="info-value" id="server-account-address">-</span>
                </div>
                <div class="server-status-actions">
                    <button class="btn btn-primary" id="btn-check-servers">Verificar Agora</button>
                </div>
            </div>
        </section>

        <!-- Metrics Section -->
        <section id="metrics" class="section">
            <h2>M√©tricas de Uso</h2>
            
            <div class="metrics-overview">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="metrics-today-commands">-</div>
                        <div class="stat-label">Comandos Hoje</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="metrics-today-users">-</div>
                        <div class="stat-label">Usu√°rios Hoje</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="metrics-total-commands">-</div>
                        <div class="stat-label">Total de Comandos</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="metrics-total-users">-</div>
                        <div class="stat-label">Total de Usu√°rios</div>
                    </div>
                </div>
            </div>

            <div class="metrics-charts-row">
                <div class="chart-card">
                    <h3>Comandos por Dia (√∫ltimos 7 dias)</h3>
                    <div class="chart-container">
                        <canvas id="chart-commands-daily"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <h3>Distribui√ß√£o por Hora (hoje)</h3>
                    <div class="chart-container">
                        <canvas id="chart-commands-hourly"></canvas>
                    </div>
                </div>
            </div>

            <div class="metrics-commands-card">
                <h3>Comandos Mais Usados</h3>
                <div class="top-commands-grid" id="top-commands-grid">
                    <div class="loading">Carregando...</div>
                </div>
            </div>

            <div class="metrics-actions">
                <button class="btn btn-secondary" id="btn-refresh-metrics">üîÑ Atualizar M√©tricas</button>
                <button class="btn btn-danger" id="btn-reset-metrics">Resetar M√©tricas</button>
            </div>
        </section>

        <!-- Alerts Section -->
        <section id="alerts" class="section">
            <h2>Gerenciar Alertas</h2>
            
            <div class="create-alert-card">
                <h3>‚ûï Criar Novo Alerta</h3>
                <form id="create-alert-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="alert-user-id">ID do Usu√°rio Discord *</label>
                            <input type="text" id="alert-user-id" placeholder="Ex: 123456789012345678" required>
                        </div>
                        <div class="form-group">
                            <label for="alert-search-term">Item *</label>
                            <input type="text" id="alert-search-term" placeholder="Nome do item" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="alert-server">Servidor *</label>
                            <select id="alert-server" required>
                                <option value="FREYA">Freya</option>
                                <option value="NIDHOGG">Nidhogg</option>
                                <option value="YGGDRASIL">Yggdrasil</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="alert-type">Tipo *</label>
                            <select id="alert-type" required>
                                <option value="BUY">Comprando</option>
                                <option value="SELL">Vendendo</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="alert-max-price">Pre√ßo M√°ximo (opcional)</label>
                            <input type="number" id="alert-max-price" placeholder="Ex: 1000000" min="0">
                        </div>
                        <div class="form-group">
                            <label for="alert-min-quantity">Quantidade M√≠nima (opcional)</label>
                            <input type="number" id="alert-min-quantity" placeholder="Ex: 10" min="1">
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-success">Criar Alerta</button>
                    </div>
                </form>
            </div>
            
            <div class="filters-card">
                <div class="filters-row">
                    <div class="filter-group">
                        <label>Servidor:</label>
                        <select id="filter-server">
                            <option value="">Todos</option>
                            <option value="FREYA">Freya</option>
                            <option value="NIDHOGG">Nidhogg</option>
                            <option value="YGGDRASIL">Yggdrasil</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Tipo:</label>
                        <select id="filter-type">
                            <option value="">Todos</option>
                            <option value="BUY">Comprando</option>
                            <option value="SELL">Vendendo</option>
                        </select>
                    </div>
                    <button class="btn btn-secondary" id="btn-filter-alerts">Filtrar</button>
                    <button class="btn btn-primary" id="btn-refresh-alerts">üîÑ Atualizar</button>
                </div>
            </div>
            
            <div class="alerts-table-container">
                <table class="alerts-table">
                    <thead>
                        <tr>
                            <th>Usu√°rio</th>
                            <th>Item</th>
                            <th>Tipo</th>
                            <th>Servidor</th>
                            <th>Pre√ßo M√°x</th>
                            <th>Menor Pre√ßo</th>
                            <th>Notifica√ß√µes</th>
                            <th>Criado em</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="alerts-table-body">
                        <tr><td colspan="9" class="loading">Carregando...</td></tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Edit Alert Modal -->
        <div id="edit-alert-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>‚úèÔ∏è Editar Alerta</h3>
                    <button class="modal-close" onclick="closeEditAlert()">&times;</button>
                </div>
                <form id="edit-alert-form" onsubmit="saveEditAlert(event)">
                    <input type="hidden" id="edit-alert-id">
                    <div class="form-group">
                        <label for="edit-alert-search">Item *</label>
                        <input type="text" id="edit-alert-search" placeholder="Nome do item" required>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-alert-server">Servidor</label>
                            <select id="edit-alert-server">
                                <option value="FREYA">Freya</option>
                                <option value="NIDHOGG">Nidhogg</option>
                                <option value="YGGDRASIL">Yggdrasil</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="edit-alert-type">Tipo</label>
                            <select id="edit-alert-type">
                                <option value="BUY">Comprando</option>
                                <option value="SELL">Vendendo</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-alert-price">Pre√ßo M√°ximo</label>
                            <input type="number" id="edit-alert-price" placeholder="Opcional" min="0">
                        </div>
                        <div class="form-group">
                            <label for="edit-alert-quantity">Quantidade M√≠nima</label>
                            <input type="number" id="edit-alert-quantity" placeholder="Opcional" min="1">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="closeEditAlert()">Cancelar</button>
                        <button type="submit" class="btn btn-primary">Salvar</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Parties Section -->
        <section id="parties" class="section">
            <h2>Gerenciar Grupos de Inst√¢ncia</h2>
            
            <div class="parties-stats">
                <div class="stat-card">
                    <div class="stat-value" id="stat-total-parties">-</div>
                    <div class="stat-label">Grupos Ativos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-open-parties">-</div>
                    <div class="stat-label">Abertos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-full-parties">-</div>
                    <div class="stat-label">Cheios</div>
                </div>
            </div>
            
            <div class="parties-toolbar">
                <div class="toolbar-filters">
                    <div class="filter-group">
                        <label for="filter-party-status">Status</label>
                        <select id="filter-party-status">
                            <option value="">Todos</option>
                            <option value="open">üü¢ Abertos</option>
                            <option value="full">üü° Cheios</option>
                            <option value="started">üîµ Iniciados</option>
                            <option value="cancelled">üî¥ Cancelados</option>
                        </select>
                    </div>
                </div>
                <div class="toolbar-actions">
                    <button class="btn btn-secondary" id="btn-filter-parties">
                        <span class="btn-icon">üîç</span> Filtrar
                    </button>
                    <button class="btn btn-primary" id="btn-refresh-parties">
                        <span class="btn-icon">üîÑ</span> Atualizar
                    </button>
                </div>
            </div>
            
            <div class="parties-table-container">
                <table class="parties-table">
                    <thead>
                        <tr>
                            <th>Inst√¢ncia</th>
                            <th>Criador</th>
                            <th>Data/Hora</th>
                            <th>Participantes</th>
                            <th>Status</th>
                            <th>Servidor</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="parties-table-body">
                        <tr><td colspan="7" class="loading">Carregando...</td></tr>
                    </tbody>
                </table>
            </div>
        </section>
        
        <!-- Edit Party Modal -->
        <div id="edit-party-modal" class="modal" style="display: none;">
            <div class="modal-content modal-lg">
                <div class="modal-header">
                    <h3>‚úèÔ∏è Editar Grupo</h3>
                    <button class="modal-close" onclick="closeEditParty()">&times;</button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="edit-party-id">
                    
                    <div class="party-info-header">
                        <h4 id="edit-party-instance">-</h4>
                        <span class="party-status-badge" id="edit-party-status">-</span>
                    </div>
                    
                    <div class="party-details">
                        <div class="detail-item">
                            <span class="detail-label">üìÖ Data/Hora:</span>
                            <span id="edit-party-datetime">-</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">üè† Servidor:</span>
                            <span id="edit-party-guild">-</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">üë§ Criador:</span>
                            <span id="edit-party-creator">-</span>
                        </div>
                    </div>
                    
                    <div class="participants-section">
                        <h4>üë• Participantes (<span id="edit-party-count">0</span>/<span id="edit-party-max">12</span>)</h4>
                        <div class="participants-list" id="edit-party-participants">
                            <p class="no-participants">Nenhum participante</p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="closeEditParty()">Fechar</button>
                </div>
            </div>
        </div>

        <!-- Config Section -->
        <section id="config" class="section">
            <h2>Configura√ß√µes do Sistema</h2>
            
            <div class="config-card">
                <h3>Intervalos e Cooldowns</h3>
                <form id="config-form">
                    <div class="form-group">
                        <label for="config-interval">Intervalo de Verifica√ß√£o (minutos)</label>
                        <input type="number" id="config-interval" min="1" max="1440" value="15">
                        <small>Com que frequ√™ncia o bot verifica por itens no mercado (1-1440 min)</small>
                    </div>
                    <div class="form-group">
                        <label for="config-cooldown">Cooldown de Notifica√ß√£o (minutos)</label>
                        <input type="number" id="config-cooldown" min="1" max="1440" value="60">
                        <small>Tempo m√≠nimo entre notifica√ß√µes do mesmo alerta (1-1440 min)</small>
                    </div>
                    <div class="form-group">
                        <label for="config-delay">Delay entre Requisi√ß√µes (ms)</label>
                        <input type="number" id="config-delay" min="500" max="10000" value="2000">
                        <small>Atraso entre cada requisi√ß√£o √† API (500-10000 ms)</small>
                    </div>
                    <div class="form-group checkbox-group">
                        <label>
                            <input type="checkbox" id="config-allow-admins" checked>
                            Admins sempre permitidos
                        </label>
                        <small>Se desabilitado, admins tamb√©m precisam estar na whitelist</small>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">Salvar Configura√ß√µes</button>
                        <button type="button" class="btn btn-secondary" id="btn-reset-config">Restaurar Padr√µes</button>
                    </div>
                </form>
            </div>
        </section>

        <!-- Permissions Section -->
        <section id="whitelist" class="section">
            <h2>Permiss√µes de Alertas</h2>
            
            <div class="permissions-add-card">
                <h3>Adicionar Permiss√£o</h3>
                <form id="permission-add-form">
                    <div class="form-row permission-form-row">
                        <select id="permission-type" class="permission-type-select">
                            <option value="userId">ID do Usu√°rio</option>
                            <option value="username">Nome de Usu√°rio</option>
                            <option value="roleId">Cargo (Role ID)</option>
                        </select>
                        <input type="text" id="permission-value" placeholder="Digite o valor..." required>
                        <button type="submit" class="btn btn-primary">Adicionar</button>
                    </div>
                    <small id="permission-help-text">Digite o ID num√©rico do usu√°rio Discord</small>
                </form>
                
                <!-- Role selector (hidden by default) -->
                <div id="role-selector-container" class="role-selector-container" style="display: none;">
                    <h4>Ou selecione um cargo:</h4>
                    <div id="role-selector" class="role-selector">
                        <div class="loading">Carregando cargos...</div>
                    </div>
                </div>
            </div>
            
            <div class="permissions-list">
                <h3>Permiss√µes Ativas</h3>
                <div class="permissions-legend">
                    <span class="legend-item"><span class="legend-color user-id"></span> ID do Usu√°rio</span>
                    <span class="legend-item"><span class="legend-color username"></span> Nome de Usu√°rio</span>
                    <span class="legend-item"><span class="legend-color role-id"></span> Cargo</span>
                </div>
                <div id="permissions-grid" class="permissions-grid">
                    <div class="loading">Carregando...</div>
                </div>
            </div>
        </section>

        <!-- News Section -->
        <section id="news" class="section">
            <h2>Not√≠cias do GNJoy</h2>
            
            <div class="news-cache-card">
                <h3>Status do Cache</h3>
                <div class="news-cache-info">
                    <div class="info-row">
                        <span class="info-label">Not√≠cias em cache:</span>
                        <span class="info-value" id="news-count">-</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">√öltima atualiza√ß√£o:</span>
                        <span class="info-value" id="news-last-refresh">-</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Dias de atualiza√ß√£o:</span>
                        <span class="info-value" id="news-refresh-days">-</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Pr√≥xima atualiza√ß√£o:</span>
                        <span class="info-value" id="news-should-refresh">-</span>
                    </div>
                </div>
                <div class="news-actions">
                    <button class="btn btn-primary" id="btn-refresh-news">For√ßar Atualiza√ß√£o</button>
                    <button class="btn btn-secondary" id="btn-reload-news">Recarregar Lista</button>
                </div>
            </div>
            
            <div class="news-stats-card">
                <h3>Categorias</h3>
                <div class="news-categories-grid">
                    <div class="news-category-card">
                        <div class="category-icon">‚ö†Ô∏è</div>
                        <div class="category-count" id="news-cat-avisos">0</div>
                        <div class="category-label">Avisos</div>
                    </div>
                    <div class="news-category-card">
                        <div class="category-icon">üîß</div>
                        <div class="category-count" id="news-cat-atualizacoes">0</div>
                        <div class="category-label">Atualiza√ß√µes</div>
                    </div>
                    <div class="news-category-card">
                        <div class="category-icon">üéâ</div>
                        <div class="category-count" id="news-cat-eventos">0</div>
                        <div class="category-label">Eventos</div>
                    </div>
                    <div class="news-category-card">
                        <div class="category-icon">üìã</div>
                        <div class="category-count" id="news-cat-outros">0</div>
                        <div class="category-label">Outros</div>
                    </div>
                </div>
            </div>
            
            <div class="news-list-card">
                <h3>Lista de Not√≠cias</h3>
                <div id="news-list" class="news-list">
                    <div class="loading">Carregando not√≠cias...</div>
                </div>
            </div>
        </section>

        <!-- Deploy Section -->
        <section id="deploy" class="section">
            <h2>Deploy de Comandos</h2>
            
            <div class="deploy-info-card">
                <h3>Comandos Dispon√≠veis</h3>
                <p class="deploy-description">
                    Selecione os comandos que deseja deployar. Se nenhum for selecionado, todos ser√£o deployados.
                </p>
                <div class="commands-selection-actions">
                    <button class="btn btn-sm btn-secondary" id="btn-select-all-commands">Selecionar Todos</button>
                    <button class="btn btn-sm btn-secondary" id="btn-deselect-all-commands">Desmarcar Todos</button>
                    <span class="selected-count" id="selected-commands-count">0 selecionados</span>
                </div>
                <div id="available-commands" class="available-commands">
                    <div class="loading">Carregando...</div>
                </div>
            </div>
            
            <div class="deploy-global-card">
                <h3>Deploy Global</h3>
                <p class="deploy-description">
                    Comandos globais ficam dispon√≠veis em todos os servidores onde o bot est√°. 
                    <strong>Pode levar at√© 1 hora</strong> para propagar.
                </p>
                <div class="deploy-status" id="global-deploy-status">
                    <span class="status-indicator"></span>
                    <span class="status-text">Carregando...</span>
                </div>
                <div class="deploy-actions">
                    <button class="btn btn-primary" id="btn-deploy-global">Fazer Deploy Global</button>
                    <button class="btn btn-danger" id="btn-clear-global">Remover Comandos Globais</button>
                </div>
            </div>
            
            <div class="deploy-guild-card">
                <h3>Deploy por Servidor</h3>
                <p class="deploy-description">
                    Comandos de servidor s√£o disponibilizados <strong>instantaneamente</strong>.
                    Ideal para testes ou servidores espec√≠ficos.
                </p>
                <div id="guilds-deploy-list" class="guilds-deploy-list">
                    <div class="loading">Carregando servidores...</div>
                </div>
            </div>
        </section>

        <!-- Logs Section -->
        <section id="logs" class="section">
            <h2>Logs do Sistema</h2>
            
            <div class="filters-card">
                <div class="filters-row">
                    <div class="filter-group">
                        <label>N√≠vel:</label>
                        <select id="filter-log-level">
                            <option value="">Todos</option>
                            <option value="ERROR">Error</option>
                            <option value="WARN">Warning</option>
                            <option value="INFO">Info</option>
                            <option value="DEBUG">Debug</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Limite:</label>
                        <select id="filter-log-limit">
                            <option value="50">50</option>
                            <option value="100" selected>100</option>
                            <option value="200">200</option>
                            <option value="500">500</option>
                        </select>
                    </div>
                    <button class="btn btn-secondary" id="btn-filter-logs">Filtrar</button>
                    <button class="btn btn-danger" id="btn-clear-logs">Limpar Logs</button>
                </div>
            </div>
            
            <div class="logs-container" id="logs-container">
                <div class="loading">Carregando...</div>
            </div>
        </section>
    </main>

    <div class="toast-container" id="toast-container"></div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="/app.js"></script>
</body>
</html>
